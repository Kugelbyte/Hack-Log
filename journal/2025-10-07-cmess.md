# Hack Log 13 - TryHackMe [CMesS](https://tryhackme.com/room/cmess)

📆:**Date:** 2025-10-07  
🔍**Objective:** Obtain user and the root flag.  
🎯**Target**: TryHackme CMesS (Lab CTF)  

---  

## 🛠️ Actions Taken  

### 🧰 Port and Service Enumeration  

```bash
nmap -sV 10.201.100.155
```

```bash
root@ip-10-201-66-195:~# nmap -sV 10.201.100.155
Starting Nmap 7.80 ( https://nmap.org ) at 2025-10-07 09:52 BST
mass_dns: warning: Unable to open /etc/resolv.conf. Try using --system-dns or specify valid servers with --dns-servers
mass_dns: warning: Unable to determine any DNS servers. Reverse DNS is disabled. Try using --system-dns or specify valid servers with --dns-servers
Nmap scan report for cmess.thm (10.201.100.155)
Host is up (0.00041s latency).
Not shown: 998 closed ports
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.8 (Ubuntu Linux; protocol 2.0)
80/tcp open  http    Apache httpd 2.4.18 ((Ubuntu))
MAC Address: 16:FF:C1:25:92:23 (Unknown)
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 8.25 seconds
```
→ Visiting http://cmess.thm running on port 80 revealed that it is a blog site running on Gila CMS.  


### 📁 Directory Enumeration  

```bash

root@ip-10-201-66-195:~# ffuf -w /usr/share/wordlists/dirb/big.txt -u http://10.201.100.155/FUZZ -fs 4098

        /'___\  /'___\           /'___\       
       /\ \__/ /\ \__/  __  __  /\ \__/       
       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\      
        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/      
         \ \_\   \ \_\  \ \____/  \ \_\       
          \/_/    \/_/   \/___/    \/_/       

       v1.3.1
________________________________________________

 :: Method           : GET
 :: URL              : http://10.201.100.155/FUZZ
 :: Wordlist         : FUZZ: /usr/share/wordlists/dirb/big.txt
 :: Follow redirects : false
 :: Calibration      : false
 :: Timeout          : 10
 :: Threads          : 40
 :: Matcher          : Response status: 200,204,301,302,307,401,403,405
 :: Filter           : Response size: 4098
________________________________________________

About                   [Status: 200, Size: 3349, Words: 372, Lines: 93]
Index                   [Status: 200, Size: 3866, Words: 522, Lines: 108]
Search                  [Status: 200, Size: 3866, Words: 522, Lines: 108]
0                       [Status: 200, Size: 3866, Words: 522, Lines: 108]
about                   [Status: 200, Size: 3363, Words: 372, Lines: 93]
admin                   [Status: 200, Size: 1585, Words: 377, Lines: 42]
.htpasswd               [Status: 403, Size: 279, Words: 20, Lines: 10]
.htaccess               [Status: 403, Size: 279, Words: 20, Lines: 10]
api                     [Status: 200, Size: 0, Words: 1, Lines: 1]
assets                  [Status: 301, Size: 328, Words: 20, Lines: 10]
author                  [Status: 200, Size: 3605, Words: 419, Lines: 102]
blog                    [Status: 200, Size: 3866, Words: 522, Lines: 108]
category                [Status: 200, Size: 3877, Words: 522, Lines: 110]
feed                    [Status: 200, Size: 735, Words: 37, Lines: 22]
fm                      [Status: 200, Size: 0, Words: 1, Lines: 1]
index                   [Status: 200, Size: 3866, Words: 522, Lines: 108]
lib                     [Status: 301, Size: 322, Words: 20, Lines: 10]
log                     [Status: 301, Size: 322, Words: 20, Lines: 10]
login                   [Status: 200, Size: 1585, Words: 377, Lines: 42]
robots.txt              [Status: 200, Size: 65, Words: 5, Lines: 5]
search                  [Status: 200, Size: 3866, Words: 522, Lines: 108]
server-status           [Status: 403, Size: 279, Words: 20, Lines: 10]
sites                   [Status: 301, Size: 326, Words: 20, Lines: 10]
src                     [Status: 301, Size: 322, Words: 20, Lines: 10]
tag                     [Status: 200, Size: 3889, Words: 523, Lines: 110]
tags                    [Status: 200, Size: 3149, Words: 337, Lines: 85]
themes                  [Status: 301, Size: 328, Words: 20, Lines: 10]
tmp                     [Status: 301, Size: 322, Words: 20, Lines: 10]
:: Progress: [20469/20469] :: Job [1/1] :: 569 req/sec :: Duration: [0:00:48] :: Errors: 0 ::
```

→ There is an "/admin" portal present.  
→ Visiting other discovered directories didn't proved to be fruitful, and the credentials to login into admin portal are also unknown.  

### Subdomain Enumeration  

→ Enumerating for any possible subdomains  

```bash

root@ip-10-201-66-195:~# ffuf -H "Host: FUZZ.cmess.thm" -u http://cmess.thm -w /usr/share/wordlists/SecLists/Discovery/DNS/subdomains-top1million-20000.txt -fw 522

        /'___\  /'___\           /'___\       
       /\ \__/ /\ \__/  __  __  /\ \__/       
       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\      
        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/      
         \ \_\   \ \_\  \ \____/  \ \_\       
          \/_/    \/_/   \/___/    \/_/       

       v1.3.1
________________________________________________

 :: Method           : GET
 :: URL              : http://cmess.thm
 :: Wordlist         : FUZZ: /usr/share/wordlists/SecLists/Discovery/DNS/subdomains-top1million-20000.txt
 :: Header           : Host: FUZZ.cmess.thm
 :: Follow redirects : false
 :: Calibration      : false
 :: Timeout          : 10
 :: Threads          : 40
 :: Matcher          : Response status: 200,204,301,302,307,401,403,405
 :: Filter           : Response words: 522
________________________________________________

dev                     [Status: 200, Size: 934, Words: 191, Lines: 31]
```

→ There is a subdomain named "dev".  

→ Visting "dev.cmess.thm" and following gets displayed  

```html

Development Log
andre@cmess.thm

Have you guys fixed the bug that was found on live?
support@cmess.thm

Hey Andre, We have managed to fix the misconfigured .htaccess file, we're hoping to patch it in the upcoming patch!
support@cmess.thm

Update! We have had to delay the patch due to unforeseen circumstances
andre@cmess.thm

That's ok, can you guys reset my password if you get a moment, I seem to be unable to get onto the admin panel.
support@cmess.thm

Your password has been reset. Here: KPFTN_f2yxe%
```

→ This log gives us credentials for the admin portal.  
  - username - andre@cmess.thm
  - password - KPFTN_f2yxe%


## Admin access and RCE

→ The credentials gave access to admin portal for the website.  
→ Gila CMS admin portal has an option to upload file to it.  Navigating to Content -> File Manager -> Upload.  
→ Uploaded a reverser shell written in php named as "shell.php".  
→ Files uploaded by this way gets stored in assets directory.  
→ Started a netcat listener.  
→ Accessing "shell.php" by "http://cmess.thm/assets/shell.php" returned the shell succesfully on the listener.  


## Horizontal Privilege Escalation  
→ Gained access as user "www-data" on the web server.  
→ Did 'sudo -l' , looked for any binaries with SUID bits but nothing yielded any results.  
→ Found a hidden file ".password.bak" at /opt directory.  
→ The file contained the password for user andre.  
  - password : UQfsdCB7aAP6
→ Successfully switched user to "andre".
→ Obtained user flag from "/home/andre/user.txt".


## Privilege Escalation   
→ Checking "/etc/crontab" entry yielded interesting result.  
```bash

# m h dom mon dow user	command
17 *	* * *	root    cd / && run-parts --report /etc/cron.hourly
25 6	* * *	root	test -x /usr/sbin/anacron || ( cd / && run-parts --report /etc/cron.daily )
47 6	* * 7	root	test -x /usr/sbin/anacron || ( cd / && run-parts --report /etc/cron.weekly )
52 6	1 * *	root	test -x /usr/sbin/anacron || ( cd / && run-parts --report /etc/cron.monthly )
*/2 *   * * *   root    cd /home/andre/backup && tar -zcf /tmp/andre_backup.tar.gz *
```
→ There is a cron job which is archiving contents of "/home/andre/backup" directory using tar and it is using wildcard.  
→ The use of wildcard "*" can lead to privlige escalation.  
→ Using the technique described in this [article](https://medium.com/@polygonben/linux-privilege-escalation-wildcards-with-tar-f79ab9e407fa) succesfully read the root flag.  



## 🔍 Key Findings  

→ The subdomain "dev" revealed credentials.  
→ File upload allowed for remote code execution.  
→ Usage of wildcard in tar lead to privilege escalation.  

## 📚 What I Learned ?  
→ Looking for subdomains is important in recon.  











