# Hack Log 6 - TryHackMe [Include](https://tryhackme.com/room/include)

ğŸ“… **Date:** 2025-06-08   
ğŸ” **Objective:** Obtain first flag from Sysmon Portal and second flag from /var/www/html directory.  
ğŸ¯ **Target:** TryHackMe Include (Lab CTF)

---

## ğŸ› ï¸ Actions Taken

- **Port and Service Enumeration**  
```
nmap -sS -sV --script=http-enum 10.10.3.246
```

| PortÂ Â Â  | ServiceÂ  | DescriptionÂ Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  |
|---------|----------|--------------------------------|
| 25/ | smtpÂ Â Â Â  | Postfix smtpdÂ Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  |
| 110 | pop3Â Â Â Â  | Dovecot pop3dÂ Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  |
| 143 | imapÂ Â Â Â  | Dovecot imapd (Ubuntu)Â Â Â Â Â Â Â Â  |
| 993 | ssl/imap | Dovecot imapd (Ubuntu)Â Â Â Â Â Â Â Â  |
| 995 | ssl/pop3 | Dovecot pop3dÂ Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  |
| 4000| httpÂ Â Â Â  | Node.js (Express middleware)Â Â  |
| 50000| httpÂ Â Â  | Apache httpd 2.4.41 ((Ubuntu)) |  


â†’ The "http-enum" script revealed "/login.php", "/templates", "/uploads" directories.  
â†’ Visiting http://10.10.3.246:50000/login.php revealed a portal called Sysmon.  
â†’ Visiting http://10.10.3.146:4000 revealed a Review App with the credentials to login into the app.    
          

- **Escalating privilege to Admin in Review Application**  

â†’ After logging into the app, opened the My Profile section.  
â†’ Profile section consisted of information displayed in key:value pair format and two input fields for submitting similar data.  
â†’ Found one key:value pair as **isAdmin:false**.  
â†’ Entered a new pair via the input fields as **isAdmin:true**.  
â†’ The action resulted in gaining admin access to the Review App.  
â†’ Two additional sections were added in the top menu bar of the Review App, named as API and Settings.  
â†’ Visiting API section revealed two internal api endpoints with their descriptions.  
  ```
    http://127.0.0.1:5000/internal-api
    http://127.0.0.1:5000/getAllAdmins101099991
  ```   
â†’ Description of the second endpoint pointed that it returns credentials in response.  

- **Discovering SSRF**

â†’ The Settings section revealed a functionality to update the Banner image.    
â†’ URL Input was present which took the URL of the image.     
â†’ Entered the address found in the API section into the URL input field and received a base64 encoded response.  
â†’ Decoding the response revealed the credentials for Sysmon portal.  
â†’ Logged into the portal and obtained the first flag.  

- **Local File Inclusion**

â†’ Upon observing the page source of the portal, found an interesting endpoint as **profile.php?img=**.    
â†’ Started fuzzing the endpoint for LFI via Burp Suite using a wordlist.  
â†’ After some time found result for /etc/passwd, which confirmed LFI.  

- **SMTP Log Poisoning**  
â†’ Started finding logs in /var/log for log poisoning.    
â†’ After some attempts found log entries in /var/log/mail.log.  
â†’ Injecting php payload.  
   - Since the target already had SMTP running on 25, accessed the service via netcat.  
   - Injected the payload in the "RCPT TO" option as:  
     ```
     HELO 10.10.3.246  
     MAIL FROM:<dummy@mail.com>  
     RCPT TO:<?php system($_GET['cmd']); ?>  
     ```
â†’ After injecting the checked the mail.log file and found an error logged stating **Illegal Address syntax** in "RCPT TO".  
â†’ This confirmed that poisoning was successfull since php was injected in "RCPT TO" which normally accepts email adresses.  

- **Exploitation**  
â†’ Crafted a new request with the endpoint as **profile.php?img=<LFI payload>mail.log&cmd=pwd**.  
â†’ After sending the request checked the entries in mail.log and found that there was an entry as "/var/www/html".  
â†’ Remote Code Execution via Log poisoning was successfull.  
â†’ Sent another request as **profile.php?img=<LFI payload>mail.log&cmd=ls%20-la** and found the hidden flag file.  
â†’ Obtained the flag via another request as  **profile.php?img=<LFI payload>mail.log&cmd=cat%20<filename>**.  


## ğŸ” Key Findings  

- Mass Assignment vulnerability which gave admin access to Review App.  
- Local API endpoints to access credentials.  
- Server Side Request Forgery in Banner Image updation functionality.  
- Local File Inclusion in "profile.php?img=" endpoint.  
- Remote Code Execution via Log Poisoning.  

## ğŸ“š What I Learned  

- Fuzzing can take time, filtering the results can help greatly.  
- Poisoning the logs to gain RCE.  





